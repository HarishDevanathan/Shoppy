{% extends "base.html" %}

{% block title %}
{{super()}}
{% endblock %}

{% block head %}
{{super()}}
<link rel="stylesheet" href="../static/styles/homepage.css">
{% endblock %}

{% block body %}
{{super()}}
<div class="container-fluid">
    <div class="row ms-1 me-1 homenav">
        <div class="col-2 text-center"><button class="btn w-100">sell</button></div>
        <div class="col-4 text-start">
            <form actions="/aboutus" class="w-100 h-100">
                <input class="w-100 h-100" type="text" placeholder="üîé search">
            </form>
        </div>
        <div class="col-2 text-center"><button class="btn w-100">cart</button></div>
        <div class="col-2 text-center"><button class="btn w-100">orders</button></div>
        <div class="col-2 text-center"><button class="btn w-100">deals</button></div>
    </div>
    <div class="container text-center imgslide w-100">
        <div class="slides">
            <div class="slide">
                <img src="../static/images/slide1.jpg" class="rounded">
            </div>
            <div class="slide">
                <img src="../static/images/slide2.png" class="rounded">
            </div>
            <div class="slide">
                <img src="../static/images/slide3.jpg" class="rounded">
            </div>
            <div class="slide">
                <img src="../static/images/slide4.png" class="rounded">
            </div>
        </div>
        <div class="buttons">
            <button id="prev">&#10094;</button>
            <button id="next">&#10095;</button>
        </div>
        <div class="dots">
            <span class="dot active" data-index="0"></span>
            <span class="dot" data-index="1"></span>
            <span class="dot" data-index="2"></span>
            <span class="dot" data-index="3"></span>
        </div>
    </div>
    <div class="container main-container">
        {% for product in productsarr %}
        <div class="prodgrid">
            <div class="pimg mb-2">
                <img src="../static/productimages/VNZJ33302041.jpg" alt="Product Image" class="rounded">
            </div>
            <div class="prodname">
                <p>| {{product.name}} | {{product.brand}} | {{product.smdesc}} |</p>
            </div>
            <div class="rating mb-2" id="rating">Rating:‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê by 1000 customers</div>
            <div class="price">
                <div class="original custom-font">‚Çπ5000</div>
                <div class="discount custom-font">‚Çπ3500</div>
                <div class="off custom-font">30% off</div>
            </div>
            <div class="delivery custom-font">
                Delivery before 20 Jan
            </div>
            <div class="addtocart">
                <button>Add to Cart</button>
            </div>
        </div>
        {% endfor %}
        </div>
    </div>
</div>

<script>
    let currentIndex = 0;
    const slides = document.querySelectorAll('.slide');
    const dots = document.querySelectorAll('.dot');
    const totalSlides = slides.length;

    function moveToSlide(index) {
        index = (index + totalSlides) % totalSlides;
        document.querySelector('.slides').style.transform = `translateX(-${index * 100}%)`;
        dots.forEach(dot => dot.classList.remove('active'));
        dots[index].classList.add('active');
        currentIndex = index;
    }

    setInterval(() => {
        currentIndex = (currentIndex + 1) % totalSlides;
        moveToSlide(currentIndex);
    }, 5000);

    document.getElementById('prev').addEventListener('click', () => {
        currentIndex = (currentIndex - 1 + totalSlides) % totalSlides;
        moveToSlide(currentIndex);
    });

    document.getElementById('next').addEventListener('click', () => {
        currentIndex = (currentIndex + 1) % totalSlides;
        moveToSlide(currentIndex);
    });

    moveToSlide(currentIndex);

    document.addEventListener('DOMContentLoaded', function () {
            sessionStorage.setItem('currentPage', window.location.pathname);
            window.addEventListener('popstate', function () {
                if (sessionStorage.getItem('currentPage') === '/home') {
                    fetch('/clear-session', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        }
                    }).then(response => {
                        if (response.ok) {
                            console.log("Session cleared successfully.");
                        }
                    });
                }
            });
        });

</script>
{% endblock %}
